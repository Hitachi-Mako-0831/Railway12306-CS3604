# 5. 订单填写与提交功能需求

## 5.1 订单填写页布局与初始状态

**Scenario**: 页面加载后正确显示初始信息
- **Given**: 用户已登录并成功导航至订单填写页。
- **When**: 页面完成加载。
- **Then**: 页面顶部应清晰展示所选车次的详细信息，包括车次号、出发与到达时间及站点。
- **And**: 页面应包含一个“选择乘客”区域，该区域以列表形式展示用户账户中已保存的常用联系人（例如，“刘蕊蕊”、“王欣”）。
- **And**: 页面核心区域为一个购票信息表单，默认包含一行乘客信息。表单字段包括“姓名”、“证件类型”、“证件号码”和“席别”。
- **And**: 在默认的乘客信息行中，“席别”下拉框应根据车次类型自动选择默认值（例如，G字头车次默认为二等座），“证件类型”默认为“居民身份证”，其余字段为空。
- **And**: 页面底部应提供一个“提交订单”按钮和一个“上一步”按钮，点击“上一步”将返回车次列表页面。

---

## 5.2 席别默认值设定

**Scenario**: 系统根据G字头车次设置默认席别
- **Given**: 用户已选择一个G字头车次并进入订单填写页。
- **When**: 页面完成加载。
- **Then**: 购票信息表单中的“席别”下拉框应自动设为“二等座”，并显示对应票价（如“二等座(¥80元)”）。

**Scenario**: 系统根据C字头车次设置默认席别
- **Given**: 用户已选择一个C字头车次并进入订单填写页。
- **When**: 页面完成加载。
- **Then**: 购票信息表单中的“席别”下拉框应自动设为“二等座”，并显示对应票价（如“二等座(¥47元)”）。

**Scenario**: 系统根据D字头车次设置默认席别
- **Given**: 用户已选择一个D字头车次并进入订单填写页。
- **When**: 页面完成加载。
- **Then**: 购票信息表单中的“席别”下拉框应自动设为“二等座”，并显示对应票价（如“二等座(¥28元)”）。

---

## 5.3 乘客选择与信息管理

**Scenario**: 用户从常用联系人列表中选择一名乘客
- **Given**: 用户位于订单填写页。
- **When**: 用户勾选一名常用联系人（例如“王三”）。
- **Then**: 系统应在购票信息表单中动态添加新的一行，并自动填充所选联系人的姓名、证件类型和证件号码。
- **And**: 这些自动填充的信息应为只读状态，用户不可修改。

**Scenario**: 用户尝试手动编辑系统填充的乘客信息
- **Given**: 用户已从常用联系人列表中选择了一名乘客。
- **When**: 用户尝试在自动填充的姓名、证件类型或证件号码字段中输入内容。
- **Then**: 系统应阻止任何编辑操作，输入框内容保持不变。

**Scenario**: 用户取消已选择的乘客
- **Given**: 用户已勾选并添加了一名乘客（例如“刘蕊蕊”）。
- **When**: 用户取消勾选该乘客。
- **Then**: 系统应从购票信息表单中移除对应的乘客信息行，并自动更新剩余行的序号。

---

## 5.4 席别选择交互

**Scenario**: 用户查看当前车次的可用席别
- **Given**: 用户位于订单填写页，并已添加至少一名乘客。
- **When**: 用户点击任一乘客信息行中的“席别”下拉菜单。
- **Then**: 下拉菜单应仅展示当前车次尚有余票的席别及其对应票价（例如，“硬卧(¥74.5元)”、“硬座(¥23.5元)”）。
- **And**: 任何已售罄的席别不应出现在此列表中。

**Scenario**: 用户更改默认的席别选择
- **Given**: 系统已为某乘客设置了默认席别。
- **When**: 用户从“席别”下拉菜单中选择了一个不同的席别。
- **Then**: 该乘客的席别选择应更新为新选项，并同步更新显示的总票价信息。

---

## 5.5 订单提交场景

**Scenario**: 在未选择任何乘客的情况下提交订单
- **Given**: 用户在订单填写页未勾选任何常用联系人。
- **When**: 用户点击“提交订单”按钮。
- **Then**: 系统应显示一个模态对话框，提示“请选择乘客！”
- **And**: 该对话框包含一个“确认”按钮，点击后关闭对话框，页面状态保持不变。

**Scenario**: 提交订单时所需车票已售罄
- **Given**: 用户已在订单填写页选择至少一名乘客，且网络连接正常。
- **When**: 用户点击“提交订单”按钮。
- **And**: 在订单确认阶段，系统检测到所选席别的余票不足以满足订单需求（可能由于并发操作导致）。
- **Then**: 系统应显示提示信息：“非常抱歉，您所选的席别已售罄！”
- **And**: 该提示包含一个“确认”按钮，点击后应将用户导航回车次列表页，以便重新选择。

**Scenario**: 成功提交订单
- **Given**: 用户已在订单填写页选择至少一名乘客，且网络连接正常。
- **When**: 用户点击“提交订单”按钮。
- **And**: 系统验证所选席别余票充足，能够满足订单需求。
- **Then**: 系统应在100毫秒内导航至订单确认与支付页面。

**Scenario**: 因网络问题导致订单提交失败
- **Given**: 用户已在订单填写页选择至少一名乘客，但网络连接异常。
- **When**: 用户点击“提交订单”按钮。
- **Then**: 系统应显示一个错误提示：“网络连接异常，请稍后重试。”
- **And**: 该提示包含一个“确认”按钮，点击后关闭提示，并停留在当前订单填写页。
