\u003c!-- 备注：车票状态支持“有票”、“无票”和“余票少于20张”，暂不支持候补功能。 --\u003e
# 4. 车次查询与筛选功能需求

## 4.1 页面布局规范

### 4.1.1 页面整体结构
- **背景**：页面采用纯白色背景。
- **布局**：采用五段式垂直布局，自上而下依次为：顶部导航区、车次搜索区、筛选条件区、车次列表展示区和页脚区。

### 4.1.2 顶部导航区
- **设计规范**：与应用首页的顶部导航区保持视觉和功能一致。
  - **品牌标识**：位于页面左上角，包含中国铁路官方Logo及“中国铁路12306”和“12306 CHINA RAILWAY”字样，点击可导航至应用首页。
  - **欢迎语**：紧邻品牌标识右侧，展示静态文本“欢迎登录12306”。

### 4.1.3 车次搜索区
- **功能**：提供输入框，允许用户指定出发站、到达站及出发日期。
- **操作**：包含一个“查询”按钮，用户点击后将根据输入条件执行车次检索。

### 4.1.4 筛选条件区
- **位置**：该区域展示于车次搜索区下方。
- **筛选维度**：用户可根据车次类型（如“GC-高铁/城际”、“D-动车”）、出发/到达车站、以及席别（如“商务座”、“一等座”、“二等座”）对查询结果进行二次筛选。
- **查询结果反馈**：
  - 若查询到匹配车次，结果将呈现在下方的车次列表区。
  - 若无匹配车次，列表区将显示提示信息：“暂无符合条件的车次”。

### 4.1.5 车次列表展示区
- **位置**：位于搜索区与筛选区下方。
- **展示形式**：查询结果以表格形式展示，列项目包括车次号、出发/到达站、出发/到达时间、行程历时、各席别票价/余票等。
- **操作**：每行车次信息右侧提供一个“预订”按钮，点击后导航至订单确认页面。
- **数据范围**：列表仅展示直达车次，不包含换乘方案。

### 4.1.6 页脚区
- **设计规范**：与应用首页的页脚区保持一致。
- **内容**：页脚左侧为友情链接集合，右侧陈列四个官方社交媒体平台的二维码矩阵。

---

## 4.2 页面进入场景

### 4.2.1 从首页快捷入口进入
**Scenario**: 用户通过首页快捷入口访问车票查询页
- **Given**: 用户在应用首页点击了“车票”快捷入口。
- **When**: 车票查询页面成功渲染。
- **Then**: 车次列表区域初始状态应为空，且搜索区的输入框应为默认状态。
- **And**: 筛选区域的所有选项均应为未选中状态。

### 4.2.2 从首页查询进入
**Scenario**: 用户在首页执行查询并成功跳转至车票查询页
- **Given**: 用户在首页的查询表单中输入了有效的出发地、到达地和日期。
- **When**: 用户执行查询操作。
- **Then**: 系统应导航至车票查询页，并在列表区展示匹配结果。
- **And**: 搜索区的输入框应自动填充用户在首页输入的查询条件。

**Scenario**: 用户在首页查询时勾选了“高铁/动车”选项
- **Given**: 用户在首页输入查询信息并勾选了“高铁/动车”选项。
- **When**: 用户执行查询操作后，车票查询页面成功加载。
- **Then**: 页面应自动在筛选区的车次类型中选中“GC-高铁/城际”与“D-动车”选项。
- **And**: 车次列表区仅展示符合条件的高铁和动车车次。

---

## 4.3 车次信息查询交互

### 4.3.1 输入框默认状态
**Scenario**: 用户进入页面但未输入出发地
- **Given**: 用户访问车票查询页面。
- **When**: 用户尚未与出发地输入框交互。
- **Then**: 系统应在出发地输入框中显示占位提示文本，如“简拼/全拼/汉字”。

**Scenario**: 用户进入页面但未输入到达地
- **Given**: 用户访问车票查询页面。
- **When**: 用户尚未与到达地输入框交互。
- **Then**: 系统应在到达地输入框中显示占位提示文本，如“简拼/全拼/汉字”。

**Scenario**: 用户进入页面但未选择出发日期
- **Given**: 用户访问车票查询页面。
- **When**: 用户尚未与出发日期选择器交互。
- **Then**: 系统应默认将当前系统日期填充至出发日期字段。

### 4.3.2 查询时输入校验
**Scenario**: 未指定任何站点信息时执行查询
- **Given**: 用户位于车票查询页面，且未在搜索区内输入出发地与到达地。
- **When**: 用户执行查询操作。
- **Then**: 出发地输入框应以高亮（如红色边框）显示，并附带提示：“请输入出发地”。
- **And**: 到达地输入框应以高亮（如红色边框）显示，并附带提示：“请输入到达地”。

**Scenario**: 查询时仅输入了到达地
- **Given**: 用户在车票查询页面仅输入了到达地。
- **When**: 用户执行查询操作。
- **Then**: 出发地输入框应高亮显示，并提示用户输入出发地。

**Scenario**: 查询时仅输入了出发地
- **Given**: 用户在车票查询页面仅输入了出发地。
- **When**: 用户执行查询操作。
- **Then**: 到达地输入框应高亮显示，并提示用户输入到达地。

### 4.3.3 站点输入的有效性验证
**Scenario**: 输入了无效的出发站点
- **Given**: 用户在出发地输入框中输入了一个数据库中不存在的站点名称。
- **When**: 用户提交查询请求。
- **Then**: 系统应提示“无法匹配该出发地”。
- **And**: 系统应在下拉建议中提供拼写相似的有效站点供用户选择。

**Scenario**: 输入了无效的到达站点
- **Given**: 用户在到达地输入框中输入了一个数据库中不存在的站点名称。
- **When**: 用户提交查询请求。
- **Then**: 系统应提示“无法匹配该到达地”。
- **And**: 系统应在下拉建议中提供拼写相似的有效站点供用户选择。

### 4.3.4 站点推荐功能
**Scenario**: 用户请求出发站点列表
- **Given**: 用户访问车票查询页面。
- **When**: 用户与出发地输入框进行交互（如点击）。
- **Then**: 系统应以下拉列表形式展示数据库中所有支持的站点。
- **And**: 用户可通过点击列表中的站点来填充输入框。

**Scenario**: 用户请求到达站点列表
- **Given**: 用户访问车票查询页面。
- **When**: 用户与到达地输入框进行交互（如点击）。
- **Then**: 系统应以下拉列表形式展示数据库中所有支持的站点。
- **And**: 用户可通过点击列表中的站点来填充输入框。

### 4.3.5 出发日期选择功能
**Scenario**: 用户选择出发日期
- **Given**: 用户访问车票查询页面。
- **When**: 用户点击出发日期选择器。
- **Then**: 系统应展示一个日历控件，其中可售日期以醒目方式（如黑色字体）展示，而不可售日期（已过时或未开放）则置灰。
- **And**: 用户选择可售日期后，该日期将被填充至输入框；选择不可售日期则无响应。

### 4.3.6 查询执行与系统响应
**Scenario**: 使用有效条件成功查询
- **Given**: 用户在搜索区提供了有效的出发地、到达地和出发日期。
- **When**: 用户执行查询操作。
- **Then**: 系统应在100毫秒内在车次列表区展示所有匹配条件的车次信息。

**Scenario**: 因系统无响应导致查询失败
- **Given**: 用户在搜索区提供了有效的查询条件。
- **When**: 用户执行查询操作，但后端服务未在规定时间内响应。
- **Then**: 系统应在100毫秒后显示错误提示：“查询失败，请稍后重试”，且不更新车次列表。

---

## 4.4 车票数据模型与逻辑

### 4.4.1 数据结构
- **核心数据**：数据库需存储车次、出发站、所有途经站、到达站，以及相邻站间的运行历时。
- **座位信息**：记录每节车厢的席别类型、座位序号，以及每个座位在任意区间内的占用状态（“空闲”或“已预定”）。
- **数据源**：所有车次的基础信息应从“车次信息.json”文件中导入。

### 4.4.2 余票计算逻辑
- **相邻站查询**：对于任意车次在相邻两站间的余票查询，直接检索并返回数据库中对应席别的“空闲”座位数量。
- **跨站查询**：对于非相邻站点的查询，需逐一检查座位在整个行程区间（从出发站到到达站）是否全程保持“空闲”状态。若满足条件，则计为一张余票。
- **无票判定**：若某一席别的所有座位在查询区间内均存在至少一段“已预定”状态，则该席别余票为零。
- **核心原则**：余票统计必须以单个座位为单位，确保其在整个查询行程中全程可用。

### 4.4.3 票价计算规则
- **计算方法**：任意两站间的某席别票价，等于该线路途经的所有子区间对应席别票价的总和。

### 4.4.4 数据更新与维护规范
- **状态变更**：当一个座位被成功预订后，系统必须立即将该座位在对应行程区间的状态从“空闲”更新为“已预定”。
- **车次管理**：数据库应支持动态添加新车次和删除既有车次的操作。
- **站点支持**：数据库支持的出发地和到达地，必须是数据库中所有车次线路所覆盖的站点集合。

---

## 4.5 车次信息筛选交互

### 4.5.1 应用筛选条件
**Scenario**: 用户按车次类型筛选
- **Given**: 车票查询页面的列表区已展示查询结果。
- **When**: 用户在筛选区的“车次类型”栏中勾选一个或多个选项。
- **Then**: 列表区应立即更新，仅显示符合所选车次类型的车次，此阶段不校验余票。

**Scenario**: 用户按出发站筛选
- **Given**: 列表区已展示查询结果。
- **When**: 用户在“出发车站”筛选栏中勾选一个或多个选项。
- **Then**: 列表区应更新，仅显示从所选车站出发的车次。

**Scenario**: 用户按到达站筛选
- **Given**: 列表区已展示查询结果。
- **When**: 用户在“到达车站”筛选栏中勾选一个或多个选项。
- **Then**: 列表区应更新，仅显示到达所选车站的车次。

**Scenario**: 用户按席别筛选
- **Given**: 列表区已展示查询结果。
- **When**: 用户在“车次席别”筛选栏中勾选一个或多个选项。
- **Then**: 列表区应更新，仅显示包含所选席别的车次，此阶段不校验余票。

**Scenario**: 用户在不同筛选维度下组合筛选
- **Given**: 列表区已展示查询结果。
- **When**: 用户在多个筛选维度下（如车次类型、出发站、席别）选择了多个条件。
- **Then**: 列表区应更新，仅显示同时满足所有已选条件的交集车次。

### 4.5.2 移除筛选条件
**Scenario**: 用户取消已选的筛选条件
- **Given**: 用户已应用了“GC-高铁/城际”筛选，且列表已更新。
- **When**: 用户取消勾选“GC-高铁/城际”复选框。
- **Then**: 列表区应移除该筛选限制，并根据剩余的筛选条件重新展示结果。

### 4.5.3 筛选区初始化与动态更新
**Scenario**: 筛选区默认状态
- **Given**: 用户首次进入车票查询页面。
- **When**: 页面加载完成但列表区为空。
- **Then**: “车次类型”筛选栏应默认提供“GC-高铁/城际”、“D-动车”等核心选项。
- **And**: “出发车站”、“到达车站”、“车次席别”等筛选栏初始状态应为空。

**Scenario**: 根据查询结果动态生成筛选选项
- **Given**: 用户执行查询操作。
- **When**: 列表区成功展示车次信息。
- **Then**: 系统应自动从结果集中提取所有不重复的出发站、到达站和席别类型，并填充至对应的筛选栏作为选项。

---

## 4.6 余票状态显示规则

**Scenario**: 余票数量明确显示（少于20张）
- **Given**: 某车次的某个席别在数据库中的余票数少于20张。
- **When**: 该车次信息在列表区展示。
- **Then**: 对应的单元格应直接显示具体的剩余票数（如“15”），字体为黑色。

**Scenario**: 余票充足时显示“有票”
- **Given**: 某车次的某个席别在数据库中的余票数大于或等于20张。
- **When**: 该车次信息在列表区展示。
- **Then**: 对应的单元格应显示“有”，字体为绿色，以示票量充足。

**Scenario**: 票已售罄时显示“无票”
- **Given**: 某车次的某个席别在数据库中的余票数为0。
- **When**: 该车次信息在列表区展示。
- **Then**: 对应的单元格应显示“无”，字体为灰色，表示已售罄。

**Scenario**: 车次不提供某席别时显示占位符
- **Given**: 列表区展示了多个车次。
- **When**: 某一车次（如G字头车次）本身不提供表格列对应的席别（如“硬卧”）。
- **Then**: 该车次在该席别对应的单元格应显示“--”，表示不适用。

**Scenario**: 用户刷新页面时更新余票信息
- **Given**: 列表区已展示车次和余票信息。
- **When**: 用户执行页面刷新操作。
- **Then**: 系统应重新从数据库获取最新的余票数据，并更新列表区所有相关单元格的显示。
